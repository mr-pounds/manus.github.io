{"version":3,"sources":["file:///E:/development/manus/themes/hugo-narrow/assets/js/navigation.js"],"sourcesContent":["/**\r\n * 统一导航功能模块\r\n *\r\n * 整合 TOC 和 Series 功能，支持 Tab 切换\r\n * 支持三种模式：card（卡片）、left（左侧边栏）、right（右侧边栏）\r\n */\r\n\r\nclass NavigationManager {\r\n  constructor() {\r\n    this.elements = {};\r\n    this.gumshoe = null;\r\n    this.gumshoeToc = null;\r\n    this.isVisible = false;\r\n    this.currentTab = 'toc';\r\n\r\n    this.init();\r\n  }\r\n\r\n  // 初始化\r\n  init() {\r\n    this.cacheElements();\r\n    this.bindEvents();\r\n    this.initGumshoe();\r\n    this.exposeAPI();\r\n    this.handleResize();\r\n  }\r\n\r\n  // 缓存 DOM 元素\r\n  cacheElements() {\r\n    this.elements = {\r\n      card: document.getElementById('navigation-card'),\r\n      overlay: document.getElementById('navigation-overlay'),\r\n      closeBtn: document.getElementById('navigation-close'),\r\n      tocContent: document.getElementById('nav-content-toc'),\r\n      seriesContent: document.getElementById('nav-content-series'),\r\n      tocTab: document.getElementById('nav-tab-toc'),\r\n      seriesTab: document.getElementById('nav-tab-series'),\r\n      tocSidebar: document.getElementById('toc-sidebar'),\r\n      seriesSidebar: document.getElementById('series-sidebar'),\r\n    };\r\n  }\r\n\r\n  // 绑定事件\r\n  bindEvents() {\r\n    const { closeBtn, overlay, tocContent, seriesContent, tocTab, seriesTab } = this.elements;\r\n\r\n    // 关闭事件\r\n    closeBtn?.addEventListener('click', () =\u003e this.hide());\r\n    overlay?.addEventListener('click', () =\u003e this.hide());\r\n\r\n    // ESC 键关闭\r\n    document.addEventListener('keydown', (e) =\u003e {\r\n      if (e.key === 'Escape' \u0026\u0026 this.isVisible) {\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    // Tab 切换事件\r\n    tocTab?.addEventListener('click', () =\u003e this.switchTab('toc'));\r\n    seriesTab?.addEventListener('click', () =\u003e this.switchTab('series'));\r\n\r\n    // TOC 链接点击 - 使用事件委托\r\n    tocContent?.addEventListener('click', (e) =\u003e {\r\n      const link = e.target.closest('a[href^=\"#\"]');\r\n      if (!link) return;\r\n\r\n      e.preventDefault();\r\n      this.scrollToTarget(link.hash);\r\n    });\r\n\r\n    // Series 链接点击 - 直接跳转，不需要特殊处理\r\n    seriesContent?.addEventListener('click', (e) =\u003e {\r\n      const link = e.target.closest('a');\r\n      if (!link) return;\r\n      \r\n      // 延迟关闭卡片\r\n      setTimeout(() =\u003e this.hide(), 100);\r\n    });\r\n  }\r\n\r\n  // 切换 Tab\r\n  switchTab(tab) {\r\n    const { tocContent, seriesContent, tocTab, seriesTab } = this.elements;\r\n    \r\n    this.currentTab = tab;\r\n\r\n    if (tab === 'toc') {\r\n      // 显示 TOC\r\n      tocContent?.classList.remove('hidden');\r\n      tocContent?.classList.add('block');\r\n      seriesContent?.classList.add('hidden');\r\n      seriesContent?.classList.remove('block');\r\n\r\n      // 更新 Tab 样式\r\n      tocTab?.classList.add('border-primary', 'text-primary');\r\n      tocTab?.classList.remove('border-transparent', 'text-muted-foreground');\r\n      tocTab?.setAttribute('aria-selected', 'true');\r\n\r\n      seriesTab?.classList.remove('border-primary', 'text-primary');\r\n      seriesTab?.classList.add('border-transparent', 'text-muted-foreground');\r\n      seriesTab?.setAttribute('aria-selected', 'false');\r\n    } else {\r\n      // 显示 Series\r\n      seriesContent?.classList.remove('hidden');\r\n      seriesContent?.classList.add('block');\r\n      tocContent?.classList.add('hidden');\r\n      tocContent?.classList.remove('block');\r\n\r\n      // 更新 Tab 样式\r\n      seriesTab?.classList.add('border-primary', 'text-primary');\r\n      seriesTab?.classList.remove('border-transparent', 'text-muted-foreground');\r\n      seriesTab?.setAttribute('aria-selected', 'true');\r\n\r\n      tocTab?.classList.remove('border-primary', 'text-primary');\r\n      tocTab?.classList.add('border-transparent', 'text-muted-foreground');\r\n      tocTab?.setAttribute('aria-selected', 'false');\r\n    }\r\n  }\r\n\r\n  // 滚动到目标位置\r\n  scrollToTarget(hash) {\r\n    const targetId = this.decodeHash(hash);\r\n    const target = document.getElementById(targetId);\r\n\r\n    if (target) {\r\n      target.scrollIntoView({\r\n        behavior: 'smooth',\r\n        block: 'start',\r\n      });\r\n\r\n      // 延迟关闭目录\r\n      setTimeout(() =\u003e this.hide(), 300);\r\n    }\r\n  }\r\n\r\n  // 解码 hash\r\n  decodeHash(hash) {\r\n    try {\r\n      return decodeURIComponent(hash.substring(1));\r\n    } catch (e) {\r\n      console.warn('Hash 解码失败:', hash);\r\n      return hash.substring(1);\r\n    }\r\n  }\r\n\r\n  // 初始化 Gumshoe\r\n  initGumshoe() {\r\n    if (typeof Gumshoe === 'undefined') {\r\n      console.warn('Gumshoe 库未加载');\r\n      return;\r\n    }\r\n\r\n    // TOC Gumshoe (卡片模式)\r\n    const tocLinks = document.querySelectorAll('#nav-content-toc a');\r\n    if (tocLinks.length \u003e 0) {\r\n      this.gumshoeToc = new Gumshoe('#nav-content-toc a', {\r\n        offset: () =\u003e window.innerHeight * 0.2,\r\n        reflow: true,\r\n        nested: true,\r\n        nestedClass: 'active-parent',\r\n        navClass: 'active',\r\n        contentClass: 'active',\r\n        events: true,\r\n      });\r\n    }\r\n\r\n    // TOC Sidebar Gumshoe\r\n    const tocSidebarLinks = document.querySelectorAll('#toc-sidebar-content a');\r\n    if (tocSidebarLinks.length \u003e 0) {\r\n      this.gumshoe = new Gumshoe('#toc-sidebar-content a', {\r\n        offset: () =\u003e window.innerHeight * 0.2,\r\n        reflow: true,\r\n        nested: true,\r\n        nestedClass: 'active-parent',\r\n        navClass: 'active',\r\n        contentClass: 'active',\r\n        events: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  // 显示导航卡片\r\n  show() {\r\n    if (!this.elements.card || this.isVisible) return;\r\n\r\n    this.isVisible = true;\r\n    this.toggleElements(true);\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  // 隐藏导航卡片\r\n  hide() {\r\n    if (!this.elements.card || !this.isVisible) return;\r\n\r\n    this.isVisible = false;\r\n    this.toggleElements(false);\r\n    document.body.style.overflow = '';\r\n  }\r\n\r\n  // 切换导航卡片显示\r\n  toggle() {\r\n    this.isVisible ? this.hide() : this.show();\r\n  }\r\n\r\n  // 切换元素显示状态\r\n  toggleElements(show) {\r\n    const { card, overlay } = this.elements;\r\n\r\n    if (show) {\r\n      overlay?.classList.remove('opacity-0', 'pointer-events-none');\r\n      overlay?.classList.add('opacity-100');\r\n\r\n      card?.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');\r\n      card?.classList.add('opacity-100', 'scale-100');\r\n    } else {\r\n      overlay?.classList.add('opacity-0', 'pointer-events-none');\r\n      overlay?.classList.remove('opacity-100');\r\n\r\n      card?.classList.add('opacity-0', 'scale-95', 'pointer-events-none');\r\n      card?.classList.remove('opacity-100', 'scale-100');\r\n    }\r\n  }\r\n\r\n  // 处理窗口大小变化\r\n  handleResize() {\r\n    let resizeTimer;\r\n    window.addEventListener('resize', () =\u003e {\r\n      clearTimeout(resizeTimer);\r\n      resizeTimer = setTimeout(() =\u003e {\r\n        // 如果在大屏幕且卡片打开，自动关闭\r\n        if (window.innerWidth \u003e= 1280 \u0026\u0026 this.isVisible) {\r\n          this.hide();\r\n        }\r\n      }, 200);\r\n    });\r\n  }\r\n\r\n  // 暴露 API\r\n  exposeAPI() {\r\n    window.Navigation = {\r\n      show: () =\u003e this.show(),\r\n      hide: () =\u003e this.hide(),\r\n      toggle: () =\u003e this.toggle(),\r\n      switchTab: (tab) =\u003e this.switchTab(tab),\r\n      isVisible: () =\u003e this.isVisible,\r\n      currentTab: () =\u003e this.currentTab,\r\n      initialized: true,\r\n    };\r\n  }\r\n\r\n  // 清理资源\r\n  cleanup() {\r\n    this.gumshoe?.destroy();\r\n    this.gumshoeToc?.destroy();\r\n    this.gumshoe = null;\r\n    this.gumshoeToc = null;\r\n  }\r\n\r\n  // 销毁\r\n  destroy() {\r\n    this.cleanup();\r\n    document.body.style.overflow = '';\r\n  }\r\n}\r\n\r\n// 初始化管理器\r\nlet navigationManagerInstance = null;\r\n\r\nfunction initNavigation() {\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () =\u003e {\r\n      navigationManagerInstance = new NavigationManager();\r\n    });\r\n  } else {\r\n    // 小延迟确保 DOM 完全渲染\r\n    setTimeout(() =\u003e {\r\n      navigationManagerInstance = new NavigationManager();\r\n    }, 50);\r\n  }\r\n}\r\n\r\n// 页面卸载时清理\r\nwindow.addEventListener('beforeunload', () =\u003e {\r\n  navigationManagerInstance?.destroy();\r\n});\r\n\r\n// 立即初始化\r\ninitNavigation();\r\n\r\n"],"mappings":"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","names":[]}